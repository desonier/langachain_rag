<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaDB Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .feature-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .hero-section {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected {
            background-color: #28a745;
            animation: pulse 2s infinite;
        }
        .status-disconnected {
            background-color: #dc3545;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .quick-stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        .main-action-button {
            font-size: 1.1em;
            padding: 12px 24px;
            font-weight: 600;
        }
        .breadcrumb-banner {
            background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #007bff;
            margin-bottom: 2rem;
        }
        .breadcrumb {
            background: transparent;
            margin-bottom: 0;
        }
        .breadcrumb-item.active {
            color: #007bff;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-database"></i> ChromaDB Admin
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" href="{{ url_for('admin_dashboard') }}">Dashboard</a>
                <a class="nav-link" href="{{ url_for('manage_collections') }}">Collections</a>
                <a class="nav-link" href="{{ url_for('manage_database') }}">Database</a>
                <a class="nav-link" href="{{ url_for('query_interface') }}">Query</a>
                <a class="nav-link" href="{{ url_for('stats_viewer') }}">Statistics</a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb Banner -->
    <div class="container mt-3">
        <div class="breadcrumb-banner p-3 rounded">
            <div class="d-flex justify-content-between align-items-center">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item active" aria-current="page">
                            <i class="fas fa-home"></i> Dashboard
                        </li>
                    </ol>
                </nav>
                <div class="d-flex align-items-center">
                    <span class="status-indicator status-connected" id="statusIndicator"></span>
                    <small class="text-muted" id="statusText">Checking connection...</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container py-5">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="fas fa-database"></i> ChromaDB Admin Interface
                    </h1>
                    <p class="lead mb-4">
                        Manage your ChromaDB collections, browse documents, and monitor database statistics 
                        with this comprehensive admin interface.
                    </p>
                    <!-- Main Action Button -->
                    <a href="{{ url_for('manage_collections') }}" class="btn btn-light btn-lg main-action-button me-3">
                        <i class="fas fa-cogs"></i> Manage Collections
                    </a>
                    <a href="{{ url_for('manage_database') }}" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-database"></i> Database
                    </a>
                </div>
                <div class="col-md-4 text-center">
                    <i class="fas fa-chart-line fa-5x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Quick Stats -->
        <div class="quick-stats mb-5">
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="mb-2">
                        <i class="fas fa-folder fa-2x text-primary"></i>
                    </div>
                    <h4 id="totalCollections">-</h4>
                    <small class="text-muted">Total Collections</small>
                </div>
                <div class="col-md-3">
                    <div class="mb-2">
                        <i class="fas fa-file-text fa-2x text-success"></i>
                    </div>
                    <h4 id="totalDocuments">-</h4>
                    <small class="text-muted">Total Documents</small>
                </div>
                <div class="col-md-3">
                    <div class="mb-2">
                        <i class="fas fa-hdd fa-2x text-info"></i>
                    </div>
                    <h4 id="databaseSize">-</h4>
                    <small class="text-muted">Database Size</small>
                </div>
                <div class="col-md-3">
                    <div class="mb-2">
                        <i class="fas fa-clock fa-2x text-warning"></i>
                    </div>
                    <h4 id="lastUpdated">-</h4>
                    <small class="text-muted">Last Updated</small>
                </div>
            </div>
        </div>

        <!-- Main Features -->
        <div class="row g-4 mb-5">
            <!-- Collection Management -->
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-3">
                            <i class="fas fa-folder-plus fa-3x text-primary"></i>
                        </div>
                        <h5 class="card-title">Collection Management</h5>
                        <p class="card-text flex-grow-1">
                            Create, delete, and manage your ChromaDB collections. 
                            View collection contents and statistics.
                        </p>
                        <a href="{{ url_for('manage_collections') }}" class="btn btn-primary">
                            <i class="fas fa-cogs"></i> Manage Collections
                        </a>
                    </div>
                </div>
            </div>

            <!-- Database Operations -->
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-3">
                            <i class="fas fa-server fa-3x text-success"></i>
                        </div>
                        <h5 class="card-title">Database Operations</h5>
                        <p class="card-text flex-grow-1">
                            Initialize, backup, or reset your ChromaDB database. 
                            Monitor database health and status.
                        </p>
                        <a href="{{ url_for('manage_database') }}" class="btn btn-success">
                            <i class="fas fa-database"></i> Manage Database
                        </a>
                    </div>
                </div>
            </div>

            <!-- Statistics & Analytics -->
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-3">
                            <i class="fas fa-chart-bar fa-3x text-info"></i>
                        </div>
                        <h5 class="card-title">Statistics & Analytics</h5>
                        <p class="card-text flex-grow-1">
                            View detailed statistics about your collections, 
                            document counts, and database usage.
                        </p>
                        <a href="{{ url_for('stats_viewer') }}" class="btn btn-info text-white">
                            <i class="fas fa-chart-line"></i> View Statistics
                        </a>
                    </div>
                </div>
            </div>

            <!-- RAG Query Interface -->
            <div class="col-md-6 col-lg-3">
                <div class="card feature-card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-3">
                            <i class="fas fa-search fa-3x text-warning"></i>
                        </div>
                        <h5 class="card-title">RAG Query Interface</h5>
                        <p class="card-text flex-grow-1">
                            Query your resume database using Azure OpenAI LLM.
                            Ask natural language questions and get intelligent answers.
                        </p>
                        <a href="{{ url_for('query_interface') }}" class="btn btn-warning text-dark">
                            <i class="fas fa-brain"></i> Query with AI
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Management Section -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-tools"></i> Management Tools</h4>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <a href="{{ url_for('manage_collections') }}" class="btn btn-outline-primary btn-lg w-100 mb-3">
                                    <i class="fas fa-cogs fa-2x d-block mb-2"></i>
                                    <strong>Manage Collections</strong>
                                    <small class="d-block text-muted">Create, edit, delete collections</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="{{ url_for('manage_database') }}" class="btn btn-outline-success btn-lg w-100 mb-3">
                                    <i class="fas fa-database fa-2x d-block mb-2"></i>
                                    <strong>Database Manager</strong>
                                    <small class="d-block text-muted">Initialize, backup, reset</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="{{ url_for('stats_viewer') }}" class="btn btn-outline-info btn-lg w-100 mb-3">
                                    <i class="fas fa-chart-bar fa-2x d-block mb-2"></i>
                                    <strong>View Statistics</strong>
                                    <small class="d-block text-muted">Analyze data and usage</small>
                                </a>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-outline-secondary btn-lg w-100 mb-3" onclick="refreshAll()">
                                    <i class="fas fa-sync-alt fa-2x d-block mb-2"></i>
                                    <strong>Refresh All</strong>
                                    <small class="d-block text-muted">Update all data</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity / System Status -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-history"></i> System Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="systemStatus">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-tools"></i> Admin Tools</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('manage_collections') }}" class="btn btn-primary">
                                <i class="fas fa-cogs"></i> Manage Collections
                            </a>
                            <button class="btn btn-outline-primary" onclick="checkDatabaseStatus()">
                                <i class="fas fa-stethoscope"></i> Check Database
                            </button>
                            <button class="btn btn-outline-info" onclick="refreshAll()">
                                <i class="fas fa-sync-alt"></i> Refresh All Data
                            </button>
                            <button class="btn btn-outline-secondary" onclick="exportConfig()">
                                <i class="fas fa-download"></i> Export Config
                            </button>
                            <hr>
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                Auto-refresh every 30 seconds
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check database status and update UI
        async function checkDatabaseStatus() {
            try {
                const response = await fetch('/api/database/status');
                const data = await response.json();
                
                const statusIndicator = document.getElementById('statusIndicator');
                const statusText = document.getElementById('statusText');
                
                if (data.success && data.status === 'connected') {
                    statusIndicator.className = 'status-indicator status-connected';
                    statusText.textContent = 'Database Connected';
                    updateStats(data.stats);
                } else {
                    statusIndicator.className = 'status-indicator status-disconnected';
                    statusText.textContent = 'Database Disconnected';
                    showDisconnectedStats();
                }
                
                updateSystemStatus(data);
            } catch (error) {
                console.error('Failed to check database status:', error);
                document.getElementById('statusIndicator').className = 'status-indicator status-disconnected';
                document.getElementById('statusText').textContent = 'Connection Error';
            }
        }

        function updateStats(stats) {
            if (stats && !stats.error) {
                document.getElementById('totalCollections').textContent = stats.total_collections || 0;
                document.getElementById('totalDocuments').textContent = stats.total_documents || 0;
                document.getElementById('databaseSize').textContent = stats.database_size || 'Unknown';
                document.getElementById('lastUpdated').textContent = stats.last_updated ? 
                    new Date(stats.last_updated).toLocaleDateString() : 'Never';
            } else {
                showDisconnectedStats();
            }
        }

        function showDisconnectedStats() {
            document.getElementById('totalCollections').textContent = '-';
            document.getElementById('totalDocuments').textContent = '-';
            document.getElementById('databaseSize').textContent = '-';
            document.getElementById('lastUpdated').textContent = '-';
        }

        function updateSystemStatus(data) {
            const statusDiv = document.getElementById('systemStatus');
            
            if (data.success) {
                statusDiv.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> 
                        <strong>System Status:</strong> All systems operational
                    </div>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> Database connection active</li>
                        <li><i class="fas fa-check text-success"></i> Collections accessible</li>
                        <li><i class="fas fa-check text-success"></i> Admin interface responsive</li>
                    </ul>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>System Status:</strong> Some issues detected
                    </div>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-times text-danger"></i> Database connection failed</li>
                        <li><i class="fas fa-question text-warning"></i> Collections status unknown</li>
                        <li><i class="fas fa-check text-success"></i> Admin interface responsive</li>
                    </ul>
                    <small class="text-muted">Error: ${data.error || 'Unknown error'}</small>
                `;
            }
        }

        // Quick action functions
        function createCollection(name) {
            // Create a form and submit it
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("manage_collections") }}';
            
            // Add collection name
            const nameInput = document.createElement('input');
            nameInput.type = 'hidden';
            nameInput.name = 'collection_name';
            nameInput.value = name;
            form.appendChild(nameInput);
            
            // Add action
            const actionInput = document.createElement('input');
            actionInput.type = 'hidden';
            actionInput.name = 'action';
            actionInput.value = 'create';
            form.appendChild(actionInput);
            
            // Submit
            document.body.appendChild(form);
            form.submit();
        }

        function refreshStats() {
            checkDatabaseStatus();
        }

        function refreshAll() {
            window.location.reload();
        }

        function exportConfig() {
            // Placeholder for export functionality
            alert('Export configuration functionality would be implemented here.');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkDatabaseStatus();
        });

        // Auto-refresh every 30 seconds
        setInterval(checkDatabaseStatus, 30000);
    </script>
</body>
</html>